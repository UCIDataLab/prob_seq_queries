==================================================
* Running for dataset wikitext
==================================================
354823168
==================================================
[2022-05-16 20:14:30.248908] batch_size ................. 512
[2022-05-16 20:14:30.248943] checkpoint_path ............ None
[2022-05-16 20:14:30.248949] cuda ....................... True
[2022-05-16 20:14:30.248952] data_path .................. data/wikitext/wikitext_val-dl.csv
[2022-05-16 20:14:30.248955] dataset_phase_shift_path ... /srv/disk00/samshow/amazon/amazon_phase_trans.pkl
[2022-05-16 20:14:30.248958] device ..................... 7
[2022-05-16 20:14:30.248960] device_num ................. 0
[2022-05-16 20:14:30.248964] disable_tqdm ............... True
[2022-05-16 20:14:30.248967] do_test .................... False
[2022-05-16 20:14:30.248970] do_valid ................... True
[2022-05-16 20:14:30.248974] dont_print_args ............ True
[2022-05-16 20:14:30.248977] dont_shuffle ............... None
[2022-05-16 20:14:30.248984] dropout .................... 0.3
[2022-05-16 20:14:30.248992] estimate_type .............. <function beam_search_lower_bound at 0x7fcd585dbc10>
[2022-05-16 20:14:30.248998] excluded_terms ............. [1]
[2022-05-16 20:14:30.249002] excluded_terms_list ........ [[]]
[2022-05-16 20:14:30.249005] finetune ................... False
[2022-05-16 20:14:30.249009] grad_clip .................. 1.0
[2022-05-16 20:14:30.249012] hidden_size ................ 128
[2022-05-16 20:14:30.249014] hist_len ................... 18
[2022-05-16 20:14:30.249017] hybrid_max_num_beams ....... 1500
[2022-05-16 20:14:30.249021] interp_func ................ <function lin_interp at 0x7fcd585dbaf0>
[2022-05-16 20:14:30.249023] log_interval ............... 100
[2022-05-16 20:14:30.249027] lr ......................... 0.001
[2022-05-16 20:14:30.249029] lr_decay_style ............. constant
[2022-05-16 20:14:30.249032] masked_lm .................. False
[2022-05-16 20:14:30.249035] max_k ...................... None
[2022-05-16 20:14:30.249038] max_num_mc_samples ......... 100000
[2022-05-16 20:14:30.249040] max_num_queries ............ 500
[2022-05-16 20:14:30.249043] min_num_mc_samples ......... 10000
[2022-05-16 20:14:30.249045] min_phase_shift ............ 0
[2022-05-16 20:14:30.249049] min_var_reduction .......... 0.1
[2022-05-16 20:14:30.249051] min_variance ............... True
[2022-05-16 20:14:30.249054] model_budget_filepath ...... None
[2022-05-16 20:14:30.249057] num_beams .................. 0.0
[2022-05-16 20:14:30.249059] num_layers ................. 2
[2022-05-16 20:14:30.249062] num_mc_samples ............. 100
[2022-05-16 20:14:30.249065] num_workers ................ 0
[2022-05-16 20:14:30.249067] optimizer .................. adam
[2022-05-16 20:14:30.249070] proposal_func .............. <function lm_proposal at 0x7fcd585cdb80>
[2022-05-16 20:14:30.249073] rnn_type ................... LSTM
[2022-05-16 20:14:30.249075] save_epochs ................ 1
[2022-05-16 20:14:30.249077] seed ....................... 42
[2022-05-16 20:14:30.249080] seq_len .................... 20
[2022-05-16 20:14:30.249082] shuffle .................... True
[2022-05-16 20:14:30.249085] store_intermediate_lbs ..... True
[2022-05-16 20:14:30.249087] sub_estimates .............. []
[2022-05-16 20:14:30.249090] tau_a_excl_terms ........... []
[2022-05-16 20:14:30.249093] tau_b_excl_terms ........... []
[2022-05-16 20:14:30.249095] terms_of_interest .......... []
[2022-05-16 20:14:30.249099] text_dict .................. None
[2022-05-16 20:14:30.249102] top_k ...................... 0
[2022-05-16 20:14:30.249104] top_p ...................... 0
[2022-05-16 20:14:30.249107] total_seq_len .............. 20
[2022-05-16 20:14:30.249109] train_data_pct ............. 0.9
[2022-05-16 20:14:30.249112] train_epochs ............... 40
[2022-05-16 20:14:30.249115] use_gpt2 ................... True
[2022-05-16 20:14:30.249117] val_data_pct ............... 0.05
[2022-05-16 20:14:30.249122] val_metrics ................ ['accuracy']
[2022-05-16 20:14:30.249124] valid_epochs ............... 1
[2022-05-16 20:14:30.249129] variance_epsilon ........... 5e-06
[2022-05-16 20:14:30.249132] vocab_size ................. 50257
[2022-05-16 20:14:30.249135] warmup_pct ................. 0.01
[2022-05-16 20:14:30.249137] weight_decay ............... 0.0
==================================================
[2022-05-16 20:14:30.250054] | Dataset: wikitext | Sample type: importance_sampling | Num samples: 1000 | Hist length 11 | Total Seq Length 15 | Pseudo GT: False | Model Budget: True

[2022-05-16 20:14:32.095475] - 0
[2022-05-16 20:14:40.378322] - 1
[2022-05-16 20:14:47.020557] - 2
[2022-05-16 20:14:55.385140] - 3
[2022-05-16 20:15:03.082486] - 4
[2022-05-16 20:15:10.920990] - 5
[2022-05-16 20:15:19.077140] - 6
[2022-05-16 20:15:27.120230] - 7
[2022-05-16 20:15:34.048630] - 8
[2022-05-16 20:15:41.695923] - 9
[2022-05-16 20:15:49.817499] - 10
[2022-05-16 20:15:56.954200] - 11
[2022-05-16 20:16:03.617343] - 12
[2022-05-16 20:16:11.529987] - 13
[2022-05-16 20:16:16.865010] - 14
[2022-05-16 20:16:23.437286] - 15
[2022-05-16 20:16:30.785721] - 16
[2022-05-16 20:16:37.640583] - 17
[2022-05-16 20:16:44.611772] - 18
[2022-05-16 20:16:52.202541] - 19
[2022-05-16 20:16:59.680783] - 20
[2022-05-16 20:17:07.237958] - 21
[2022-05-16 20:17:12.912603] - 22
[2022-05-16 20:17:18.600469] - 23
[2022-05-16 20:17:23.768398] - 24
[2022-05-16 20:17:31.141829] - 25
[2022-05-16 20:17:38.890888] - 26
[2022-05-16 20:17:44.978673] - 27
[2022-05-16 20:17:52.216516] - 28
[2022-05-16 20:17:58.993287] - 29
[2022-05-16 20:18:06.401727] - 30
[2022-05-16 20:18:14.191050] - 31
[2022-05-16 20:18:21.396095] - 32
[2022-05-16 20:18:28.990632] - 33
[2022-05-16 20:18:35.196128] - 34
[2022-05-16 20:18:40.732072] - 35
[2022-05-16 20:18:48.766004] - 36
[2022-05-16 20:18:56.271995] - 37
[2022-05-16 20:19:03.567381] - 38
[2022-05-16 20:19:11.344213] - 39
[2022-05-16 20:19:19.422982] - 40
[2022-05-16 20:19:25.682635] - 41
[2022-05-16 20:19:33.326602] - 42
[2022-05-16 20:19:37.277151] - 43
[2022-05-16 20:19:44.306452] - 44
[2022-05-16 20:19:51.611866] - 45
[2022-05-16 20:19:59.199495] - 46
[2022-05-16 20:20:04.915023] - 47
[2022-05-16 20:20:10.608711] - 48
[2022-05-16 20:20:18.175416] - 49
[2022-05-16 20:20:22.488139] - 50
[2022-05-16 20:20:28.499739] - 51
[2022-05-16 20:20:36.322097] - 52
[2022-05-16 20:20:44.125348] - 53
[2022-05-16 20:20:51.928627] - 54
[2022-05-16 20:20:58.976100] - 55
[2022-05-16 20:21:06.839555] - 56
[2022-05-16 20:21:14.372694] - 57
[2022-05-16 20:21:21.375818] - 58
[2022-05-16 20:21:27.697608] - 59
[2022-05-16 20:21:34.593184] - 60
[2022-05-16 20:21:42.246180] - 61
[2022-05-16 20:21:49.783781] - 62
[2022-05-16 20:21:56.788576] - 63
[2022-05-16 20:22:02.855773] - 64
[2022-05-16 20:22:09.608559] - 65
[2022-05-16 20:22:17.883049] - 66
[2022-05-16 20:22:23.624440] - 67
[2022-05-16 20:22:26.992521] - 68
[2022-05-16 20:22:33.066148] - 69
[2022-05-16 20:22:40.697852] - 70
[2022-05-16 20:22:47.410708] - 71
[2022-05-16 20:22:51.227616] - 72
[2022-05-16 20:22:58.505196] - 73
[2022-05-16 20:23:05.287795] - 74
[2022-05-16 20:23:11.903445] - 75
[2022-05-16 20:23:16.624395] - 76
[2022-05-16 20:23:22.964919] - 77
Traceback (most recent call last):
  File "scripts/get_importance_sampling.py", line 128, in <module>
    estimates = sample_dynamic_target_token(args, val_dl, model)
  File "/home/showalte/.conda/envs/nlpenv/lib/python3.8/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/showalte/research/prob_seq_queries/seq_queries/experiments.py", line 398, in sample_dynamic_target_token
    sample_output =args.estimate_type(sample,**kwargs)
  File "/home/showalte/.conda/envs/nlpenv/lib/python3.8/site-packages/torch/autograd/grad_mode.py", line 27, in decorate_context
    return func(*args, **kwargs)
  File "/home/showalte/research/prob_seq_queries/seq_queries/sample.py", line 182, in mc_estimate
    sample_out = proposal_func(
  File "/home/showalte/research/prob_seq_queries/seq_queries/sample.py", line 98, in lm_proposal
    proposal_log_prob += torch.gather(logits, dim=-1, index=last_sample).squeeze(-1)
RuntimeError: output with shape [] doesn't match the broadcast shape [1]
